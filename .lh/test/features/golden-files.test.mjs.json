{
    "sourceFile": "test/features/golden-files.test.mjs",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1758645130123,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758645941413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n import { readFileSync } from 'node:fs';\n import { join } from 'node:path';\n import { beforeEach, describe, expect, it } from 'vitest';\n import { z } from 'zod';\n-import { convert, formatTo, parseFrom } from '../../src/core/main.mjs';\n+import { convert, formatTo, parseFrom } from '../setup.mjs';\n \n describe('Golden Files Testing', () => {\n   const SimpleSchema = z.object({\n     name: z.string(),\n"
                },
                {
                    "date": 1758647896757,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,25 +39,29 @@\n \n   describe('Simple Data Golden Files', () => {\n     it('should parse simple JSON golden file', async () => {\n       const goldenFile = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n-      const result = await parseFrom(SimpleSchema, 'json', goldenFile);\n+      const result = await parseFrom(z.array(SimpleSchema), 'json', goldenFile);\n \n-      expect(result).toEqual({\n-        name: 'John Doe',\n-        age: 30,\n-        active: true,\n-      });\n+      expect(result).toEqual([\n+        {\n+          name: 'John Doe',\n+          age: 30,\n+          active: true,\n+        },\n+      ]);\n     });\n \n     it('should format simple data to match golden JSON', async () => {\n-      const data = {\n-        name: 'John Doe',\n-        age: 30,\n-        active: true,\n-      };\n+      const data = [\n+        {\n+          name: 'John Doe',\n+          age: 30,\n+          active: true,\n+        },\n+      ];\n \n-      const result = await formatTo(SimpleSchema, 'json', data, { deterministic: true });\n+      const result = await formatTo(z.array(SimpleSchema), 'json', data, { deterministic: true });\n       const goldenFile = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n \n       // Parse both to compare structure (ignoring whitespace differences)\n       const parsedResult = JSON.parse(result);\n@@ -67,49 +71,57 @@\n     });\n \n     it('should parse simple CSV golden file', async () => {\n       const goldenFile = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n-      const result = await parseFrom(SimpleSchema, 'csv', goldenFile);\n+      const result = await parseFrom(z.array(SimpleSchema), 'csv', goldenFile);\n \n-      expect(result).toEqual({\n-        name: 'John Doe',\n-        age: 30,\n-        active: true,\n-      });\n+      expect(result).toEqual([\n+        {\n+          name: 'John Doe',\n+          age: 30,\n+          active: true,\n+        },\n+      ]);\n     });\n \n     it('should format simple data to match golden CSV', async () => {\n-      const data = {\n-        name: 'John Doe',\n-        age: 30,\n-        active: true,\n-      };\n+      const data = [\n+        {\n+          name: 'John Doe',\n+          age: 30,\n+          active: true,\n+        },\n+      ];\n \n-      const result = await formatTo(SimpleSchema, 'csv', data);\n+      const result = await formatTo(z.array(SimpleSchema), 'csv', data);\n       const goldenFile = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n \n       expect(result.trim()).toBe(goldenFile.trim());\n     });\n \n     it('should parse simple NDJSON golden file', async () => {\n       const goldenFile = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n-      const result = await parseFrom(SimpleSchema, 'ndjson', goldenFile);\n+      const result = await parseFrom(z.array(SimpleSchema), 'ndjson', goldenFile);\n \n-      expect(result).toEqual({\n-        name: 'John Doe',\n-        age: 30,\n-        active: true,\n-      });\n+      expect(result).toEqual([\n+        {\n+          name: 'John Doe',\n+          age: 30,\n+          active: true,\n+        },\n+      ]);\n     });\n \n     it('should format simple data to match golden NDJSON', async () => {\n-      const data = {\n-        name: 'John Doe',\n-        age: 30,\n-        active: true,\n-      };\n+      const data = [\n+        {\n+          name: 'John Doe',\n+          age: 30,\n+          active: true,\n+        },\n+      ];\n \n-      const result = await formatTo(SimpleSchema, 'ndjson', data);\n+      const result = await formatTo(z.array(SimpleSchema), 'ndjson', data);\n       const goldenFile = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n \n       expect(result.trim()).toBe(goldenFile.trim());\n     });\n@@ -124,12 +136,8 @@\n         id: '123e4567-e89b-12d3-a456-426614174000',\n         metadata: {\n           tags: ['important', 'test'],\n           score: 90,\n-          nested: {\n-            value: 'test-value',\n-            optional: 'present',\n-          },\n         },\n         items: [\n           {\n             id: 1,\n@@ -150,12 +158,8 @@\n         id: '123e4567-e89b-12d3-a456-426614174000',\n         metadata: {\n           tags: ['important', 'test'],\n           score: 90,\n-          nested: {\n-            value: 'test-value',\n-            optional: 'present',\n-          },\n         },\n         items: [\n           {\n             id: 1,\n@@ -181,49 +185,65 @@\n     });\n \n     it('should parse complex CSV golden file', async () => {\n       const goldenFile = readFileSync(join(fixturesDir, 'complex.csv'), 'utf8');\n-      const result = await parseFrom(ComplexSchema, 'csv', goldenFile);\n+      const ItemSchema = z.object({\n+        id: z.number(),\n+        name: z.string(),\n+        active: z.boolean(),\n+      });\n+      const result = await parseFrom(z.array(ItemSchema), 'csv', goldenFile);\n \n-      expect(result).toEqual({\n-        id: 1,\n-        name: 'Item 1',\n-        active: true,\n-      });\n+      expect(result).toEqual([\n+        { id: 1, name: 'Item 1', active: true },\n+        { id: 2, name: 'Item 2', active: false },\n+      ]);\n     });\n \n     it('should format complex data to match golden CSV', async () => {\n-      const data = {\n-        id: 1,\n-        name: 'Item 1',\n-        active: true,\n-      };\n+      const data = [\n+        { id: 1, name: 'Item 1', active: true },\n+        { id: 2, name: 'Item 2', active: false },\n+      ];\n+      const ItemSchema = z.object({\n+        id: z.number(),\n+        name: z.string(),\n+        active: z.boolean(),\n+      });\n \n-      const result = await formatTo(ComplexSchema, 'csv', data);\n+      const result = await formatTo(z.array(ItemSchema), 'csv', data);\n       const goldenFile = readFileSync(join(fixturesDir, 'complex.csv'), 'utf8');\n \n       expect(result.trim()).toBe(goldenFile.trim());\n     });\n \n     it('should parse complex NDJSON golden file', async () => {\n       const goldenFile = readFileSync(join(fixturesDir, 'complex.ndjson'), 'utf8');\n-      const result = await parseFrom(ComplexSchema, 'ndjson', goldenFile);\n+      const ItemSchema = z.object({\n+        id: z.number(),\n+        name: z.string(),\n+        active: z.boolean(),\n+      });\n+      const result = await parseFrom(z.array(ItemSchema), 'ndjson', goldenFile);\n \n-      expect(result).toEqual({\n-        id: 1,\n-        name: 'Item 1',\n-        active: true,\n-      });\n+      expect(result).toEqual([\n+        { id: 1, name: 'Item 1', active: true },\n+        { id: 2, name: 'Item 2', active: false },\n+      ]);\n     });\n \n     it('should format complex data to match golden NDJSON', async () => {\n-      const data = {\n-        id: 1,\n-        name: 'Item 1',\n-        active: true,\n-      };\n+      const data = [\n+        { id: 1, name: 'Item 1', active: true },\n+        { id: 2, name: 'Item 2', active: false },\n+      ];\n+      const ItemSchema = z.object({\n+        id: z.number(),\n+        name: z.string(),\n+        active: z.boolean(),\n+      });\n \n-      const result = await formatTo(ComplexSchema, 'ndjson', data);\n+      const result = await formatTo(z.array(ItemSchema), 'ndjson', data);\n       const goldenFile = readFileSync(join(fixturesDir, 'complex.ndjson'), 'utf8');\n \n       expect(result.trim()).toBe(goldenFile.trim());\n     });\n@@ -233,18 +253,18 @@\n     it('should convert JSON golden to CSV and match golden CSV', async () => {\n       const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n       const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n \n-      const result = await convert(SimpleSchema, { from: 'json', to: 'csv' }, jsonGolden);\n+      const result = await convert(z.array(SimpleSchema), { from: 'json', to: 'csv' }, jsonGolden);\n \n       expect(result.trim()).toBe(csvGolden.trim());\n     });\n \n     it('should convert CSV golden to JSON and match golden JSON', async () => {\n       const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n       const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n \n-      const result = await convert(SimpleSchema, { from: 'csv', to: 'json' }, csvGolden);\n+      const result = await convert(z.array(SimpleSchema), { from: 'csv', to: 'json' }, csvGolden);\n \n       // Parse both to compare structure (ignoring whitespace differences)\n       const parsedResult = JSON.parse(result);\n       const parsedGolden = JSON.parse(jsonGolden);\n@@ -255,18 +275,26 @@\n     it('should convert JSON golden to NDJSON and match golden NDJSON', async () => {\n       const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n       const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n \n-      const result = await convert(SimpleSchema, { from: 'json', to: 'ndjson' }, jsonGolden);\n+      const result = await convert(\n+        z.array(SimpleSchema),\n+        { from: 'json', to: 'ndjson' },\n+        jsonGolden\n+      );\n \n       expect(result.trim()).toBe(ndjsonGolden.trim());\n     });\n \n     it('should convert NDJSON golden to JSON and match golden JSON', async () => {\n       const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n       const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n \n-      const result = await convert(SimpleSchema, { from: 'ndjson', to: 'json' }, ndjsonGolden);\n+      const result = await convert(\n+        z.array(SimpleSchema),\n+        { from: 'ndjson', to: 'json' },\n+        ndjsonGolden\n+      );\n \n       // Parse both to compare structure (ignoring whitespace differences)\n       const parsedResult = JSON.parse(result);\n       const parsedGolden = JSON.parse(jsonGolden);\n@@ -277,18 +305,22 @@\n     it('should convert CSV golden to NDJSON and match golden NDJSON', async () => {\n       const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n       const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n \n-      const result = await convert(SimpleSchema, { from: 'csv', to: 'ndjson' }, csvGolden);\n+      const result = await convert(z.array(SimpleSchema), { from: 'csv', to: 'ndjson' }, csvGolden);\n \n       expect(result.trim()).toBe(ndjsonGolden.trim());\n     });\n \n     it('should convert NDJSON golden to CSV and match golden CSV', async () => {\n       const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n       const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n \n-      const result = await convert(SimpleSchema, { from: 'ndjson', to: 'csv' }, ndjsonGolden);\n+      const result = await convert(\n+        z.array(SimpleSchema),\n+        { from: 'ndjson', to: 'csv' },\n+        ndjsonGolden\n+      );\n \n       expect(result.trim()).toBe(csvGolden.trim());\n     });\n   });\n@@ -297,10 +329,12 @@\n     it('should maintain data integrity through JSON round-trip', async () => {\n       const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n \n       // Parse then format\n-      const parsed = await parseFrom(SimpleSchema, 'json', jsonGolden);\n-      const formatted = await formatTo(SimpleSchema, 'json', parsed, { deterministic: true });\n+      const parsed = await parseFrom(z.array(SimpleSchema), 'json', jsonGolden);\n+      const formatted = await formatTo(z.array(SimpleSchema), 'json', parsed, {\n+        deterministic: true,\n+      });\n \n       // Parse the formatted result\n       const roundTripParsed = JSON.parse(formatted);\n       const originalParsed = JSON.parse(jsonGolden);\n@@ -311,28 +345,28 @@\n     it('should maintain data integrity through CSV round-trip', async () => {\n       const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n \n       // Parse then format\n-      const parsed = await parseFrom(SimpleSchema, 'csv', csvGolden);\n-      const formatted = await formatTo(SimpleSchema, 'csv', parsed);\n+      const parsed = await parseFrom(z.array(SimpleSchema), 'csv', csvGolden);\n+      const formatted = await formatTo(z.array(SimpleSchema), 'csv', parsed);\n \n       // Parse the formatted result\n-      const roundTripParsed = await parseFrom(SimpleSchema, 'csv', formatted);\n-      const originalParsed = await parseFrom(SimpleSchema, 'csv', csvGolden);\n+      const roundTripParsed = await parseFrom(z.array(SimpleSchema), 'csv', formatted);\n+      const originalParsed = await parseFrom(z.array(SimpleSchema), 'csv', csvGolden);\n \n       expect(roundTripParsed).toEqual(originalParsed);\n     });\n \n     it('should maintain data integrity through NDJSON round-trip', async () => {\n       const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n \n       // Parse then format\n-      const parsed = await parseFrom(SimpleSchema, 'ndjson', ndjsonGolden);\n-      const formatted = await formatTo(SimpleSchema, 'ndjson', parsed);\n+      const parsed = await parseFrom(z.array(SimpleSchema), 'ndjson', ndjsonGolden);\n+      const formatted = await formatTo(z.array(SimpleSchema), 'ndjson', parsed);\n \n       // Parse the formatted result\n-      const roundTripParsed = await parseFrom(SimpleSchema, 'ndjson', formatted);\n-      const originalParsed = await parseFrom(SimpleSchema, 'ndjson', ndjsonGolden);\n+      const roundTripParsed = await parseFrom(z.array(SimpleSchema), 'ndjson', formatted);\n+      const originalParsed = await parseFrom(z.array(SimpleSchema), 'ndjson', ndjsonGolden);\n \n       expect(roundTripParsed).toEqual(originalParsed);\n     });\n \n@@ -431,11 +465,11 @@\n       const simpleJson = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n       const simpleCsv = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n       const simpleNdjson = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n \n-      const jsonResult = await parseFrom(SimpleSchema, 'json', simpleJson);\n-      const csvResult = await parseFrom(SimpleSchema, 'csv', simpleCsv);\n-      const ndjsonResult = await parseFrom(SimpleSchema, 'ndjson', simpleNdjson);\n+      const jsonResult = await parseFrom(z.array(SimpleSchema), 'json', simpleJson);\n+      const csvResult = await parseFrom(z.array(SimpleSchema), 'csv', simpleCsv);\n+      const ndjsonResult = await parseFrom(z.array(SimpleSchema), 'ndjson', simpleNdjson);\n \n       expect(jsonResult).toEqual(csvResult);\n       expect(jsonResult).toEqual(ndjsonResult);\n       expect(csvResult).toEqual(ndjsonResult);\n"
                }
            ],
            "date": 1758645130123,
            "name": "Commit-0",
            "content": "/**\n * Golden Files Tests\n * @fileoverview Tests using golden files for deterministic output validation\n */\n\nimport { readFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { beforeEach, describe, expect, it } from 'vitest';\nimport { z } from 'zod';\nimport { convert, formatTo, parseFrom } from '../../src/core/main.mjs';\n\ndescribe('Golden Files Testing', () => {\n  const SimpleSchema = z.object({\n    name: z.string(),\n    age: z.number(),\n    active: z.boolean(),\n  });\n\n  const ComplexSchema = z.object({\n    id: z.string(),\n    metadata: z.object({\n      tags: z.array(z.string()),\n      score: z.number(),\n    }),\n    items: z.array(\n      z.object({\n        id: z.number(),\n        name: z.string(),\n        active: z.boolean(),\n      })\n    ),\n  });\n\n  const fixturesDir = join(process.cwd(), 'test', 'fixtures', 'golden');\n\n  beforeEach(() => {\n    // Ensure clean state for each test\n  });\n\n  describe('Simple Data Golden Files', () => {\n    it('should parse simple JSON golden file', async () => {\n      const goldenFile = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n      const result = await parseFrom(SimpleSchema, 'json', goldenFile);\n\n      expect(result).toEqual({\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      });\n    });\n\n    it('should format simple data to match golden JSON', async () => {\n      const data = {\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      };\n\n      const result = await formatTo(SimpleSchema, 'json', data, { deterministic: true });\n      const goldenFile = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n\n      // Parse both to compare structure (ignoring whitespace differences)\n      const parsedResult = JSON.parse(result);\n      const parsedGolden = JSON.parse(goldenFile);\n\n      expect(parsedResult).toEqual(parsedGolden);\n    });\n\n    it('should parse simple CSV golden file', async () => {\n      const goldenFile = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n      const result = await parseFrom(SimpleSchema, 'csv', goldenFile);\n\n      expect(result).toEqual({\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      });\n    });\n\n    it('should format simple data to match golden CSV', async () => {\n      const data = {\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      };\n\n      const result = await formatTo(SimpleSchema, 'csv', data);\n      const goldenFile = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n\n      expect(result.trim()).toBe(goldenFile.trim());\n    });\n\n    it('should parse simple NDJSON golden file', async () => {\n      const goldenFile = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n      const result = await parseFrom(SimpleSchema, 'ndjson', goldenFile);\n\n      expect(result).toEqual({\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      });\n    });\n\n    it('should format simple data to match golden NDJSON', async () => {\n      const data = {\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      };\n\n      const result = await formatTo(SimpleSchema, 'ndjson', data);\n      const goldenFile = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n\n      expect(result.trim()).toBe(goldenFile.trim());\n    });\n  });\n\n  describe('Complex Data Golden Files', () => {\n    it('should parse complex JSON golden file', async () => {\n      const goldenFile = readFileSync(join(fixturesDir, 'complex.json'), 'utf8');\n      const result = await parseFrom(ComplexSchema, 'json', goldenFile);\n\n      expect(result).toEqual({\n        id: '123e4567-e89b-12d3-a456-426614174000',\n        metadata: {\n          tags: ['important', 'test'],\n          score: 90,\n          nested: {\n            value: 'test-value',\n            optional: 'present',\n          },\n        },\n        items: [\n          {\n            id: 1,\n            name: 'Item 1',\n            active: true,\n          },\n          {\n            id: 2,\n            name: 'Item 2',\n            active: false,\n          },\n        ],\n      });\n    });\n\n    it('should format complex data to match golden JSON', async () => {\n      const data = {\n        id: '123e4567-e89b-12d3-a456-426614174000',\n        metadata: {\n          tags: ['important', 'test'],\n          score: 90,\n          nested: {\n            value: 'test-value',\n            optional: 'present',\n          },\n        },\n        items: [\n          {\n            id: 1,\n            name: 'Item 1',\n            active: true,\n          },\n          {\n            id: 2,\n            name: 'Item 2',\n            active: false,\n          },\n        ],\n      };\n\n      const result = await formatTo(ComplexSchema, 'json', data, { deterministic: true });\n      const goldenFile = readFileSync(join(fixturesDir, 'complex.json'), 'utf8');\n\n      // Parse both to compare structure (ignoring whitespace differences)\n      const parsedResult = JSON.parse(result);\n      const parsedGolden = JSON.parse(goldenFile);\n\n      expect(parsedResult).toEqual(parsedGolden);\n    });\n\n    it('should parse complex CSV golden file', async () => {\n      const goldenFile = readFileSync(join(fixturesDir, 'complex.csv'), 'utf8');\n      const result = await parseFrom(ComplexSchema, 'csv', goldenFile);\n\n      expect(result).toEqual({\n        id: 1,\n        name: 'Item 1',\n        active: true,\n      });\n    });\n\n    it('should format complex data to match golden CSV', async () => {\n      const data = {\n        id: 1,\n        name: 'Item 1',\n        active: true,\n      };\n\n      const result = await formatTo(ComplexSchema, 'csv', data);\n      const goldenFile = readFileSync(join(fixturesDir, 'complex.csv'), 'utf8');\n\n      expect(result.trim()).toBe(goldenFile.trim());\n    });\n\n    it('should parse complex NDJSON golden file', async () => {\n      const goldenFile = readFileSync(join(fixturesDir, 'complex.ndjson'), 'utf8');\n      const result = await parseFrom(ComplexSchema, 'ndjson', goldenFile);\n\n      expect(result).toEqual({\n        id: 1,\n        name: 'Item 1',\n        active: true,\n      });\n    });\n\n    it('should format complex data to match golden NDJSON', async () => {\n      const data = {\n        id: 1,\n        name: 'Item 1',\n        active: true,\n      };\n\n      const result = await formatTo(ComplexSchema, 'ndjson', data);\n      const goldenFile = readFileSync(join(fixturesDir, 'complex.ndjson'), 'utf8');\n\n      expect(result.trim()).toBe(goldenFile.trim());\n    });\n  });\n\n  describe('Cross-Format Golden File Conversion', () => {\n    it('should convert JSON golden to CSV and match golden CSV', async () => {\n      const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n      const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n\n      const result = await convert(SimpleSchema, { from: 'json', to: 'csv' }, jsonGolden);\n\n      expect(result.trim()).toBe(csvGolden.trim());\n    });\n\n    it('should convert CSV golden to JSON and match golden JSON', async () => {\n      const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n      const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n\n      const result = await convert(SimpleSchema, { from: 'csv', to: 'json' }, csvGolden);\n\n      // Parse both to compare structure (ignoring whitespace differences)\n      const parsedResult = JSON.parse(result);\n      const parsedGolden = JSON.parse(jsonGolden);\n\n      expect(parsedResult).toEqual(parsedGolden);\n    });\n\n    it('should convert JSON golden to NDJSON and match golden NDJSON', async () => {\n      const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n      const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n\n      const result = await convert(SimpleSchema, { from: 'json', to: 'ndjson' }, jsonGolden);\n\n      expect(result.trim()).toBe(ndjsonGolden.trim());\n    });\n\n    it('should convert NDJSON golden to JSON and match golden JSON', async () => {\n      const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n      const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n\n      const result = await convert(SimpleSchema, { from: 'ndjson', to: 'json' }, ndjsonGolden);\n\n      // Parse both to compare structure (ignoring whitespace differences)\n      const parsedResult = JSON.parse(result);\n      const parsedGolden = JSON.parse(jsonGolden);\n\n      expect(parsedResult).toEqual(parsedGolden);\n    });\n\n    it('should convert CSV golden to NDJSON and match golden NDJSON', async () => {\n      const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n      const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n\n      const result = await convert(SimpleSchema, { from: 'csv', to: 'ndjson' }, csvGolden);\n\n      expect(result.trim()).toBe(ndjsonGolden.trim());\n    });\n\n    it('should convert NDJSON golden to CSV and match golden CSV', async () => {\n      const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n      const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n\n      const result = await convert(SimpleSchema, { from: 'ndjson', to: 'csv' }, ndjsonGolden);\n\n      expect(result.trim()).toBe(csvGolden.trim());\n    });\n  });\n\n  describe('Round-Trip Golden File Testing', () => {\n    it('should maintain data integrity through JSON round-trip', async () => {\n      const jsonGolden = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n\n      // Parse then format\n      const parsed = await parseFrom(SimpleSchema, 'json', jsonGolden);\n      const formatted = await formatTo(SimpleSchema, 'json', parsed, { deterministic: true });\n\n      // Parse the formatted result\n      const roundTripParsed = JSON.parse(formatted);\n      const originalParsed = JSON.parse(jsonGolden);\n\n      expect(roundTripParsed).toEqual(originalParsed);\n    });\n\n    it('should maintain data integrity through CSV round-trip', async () => {\n      const csvGolden = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n\n      // Parse then format\n      const parsed = await parseFrom(SimpleSchema, 'csv', csvGolden);\n      const formatted = await formatTo(SimpleSchema, 'csv', parsed);\n\n      // Parse the formatted result\n      const roundTripParsed = await parseFrom(SimpleSchema, 'csv', formatted);\n      const originalParsed = await parseFrom(SimpleSchema, 'csv', csvGolden);\n\n      expect(roundTripParsed).toEqual(originalParsed);\n    });\n\n    it('should maintain data integrity through NDJSON round-trip', async () => {\n      const ndjsonGolden = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n\n      // Parse then format\n      const parsed = await parseFrom(SimpleSchema, 'ndjson', ndjsonGolden);\n      const formatted = await formatTo(SimpleSchema, 'ndjson', parsed);\n\n      // Parse the formatted result\n      const roundTripParsed = await parseFrom(SimpleSchema, 'ndjson', formatted);\n      const originalParsed = await parseFrom(SimpleSchema, 'ndjson', ndjsonGolden);\n\n      expect(roundTripParsed).toEqual(originalParsed);\n    });\n\n    it('should maintain data integrity through complex round-trip', async () => {\n      const jsonGolden = readFileSync(join(fixturesDir, 'complex.json'), 'utf8');\n\n      // Parse then format\n      const parsed = await parseFrom(ComplexSchema, 'json', jsonGolden);\n      const formatted = await formatTo(ComplexSchema, 'json', parsed, { deterministic: true });\n\n      // Parse the formatted result\n      const roundTripParsed = JSON.parse(formatted);\n      const originalParsed = JSON.parse(jsonGolden);\n\n      expect(roundTripParsed).toEqual(originalParsed);\n    });\n  });\n\n  describe('Deterministic Output Testing', () => {\n    it('should produce deterministic JSON output', async () => {\n      const data = {\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      };\n\n      const result1 = await formatTo(SimpleSchema, 'json', data, { deterministic: true });\n      const result2 = await formatTo(SimpleSchema, 'json', data, { deterministic: true });\n\n      expect(result1).toBe(result2);\n    });\n\n    it('should produce deterministic CSV output', async () => {\n      const data = {\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      };\n\n      const result1 = await formatTo(SimpleSchema, 'csv', data);\n      const result2 = await formatTo(SimpleSchema, 'csv', data);\n\n      expect(result1).toBe(result2);\n    });\n\n    it('should produce deterministic NDJSON output', async () => {\n      const data = {\n        name: 'John Doe',\n        age: 30,\n        active: true,\n      };\n\n      const result1 = await formatTo(SimpleSchema, 'ndjson', data);\n      const result2 = await formatTo(SimpleSchema, 'ndjson', data);\n\n      expect(result1).toBe(result2);\n    });\n  });\n\n  describe('Golden File Validation', () => {\n    it('should validate that golden files are well-formed', async () => {\n      const goldenFiles = [\n        'simple.json',\n        'simple.csv',\n        'simple.ndjson',\n        'complex.json',\n        'complex.csv',\n        'complex.ndjson',\n      ];\n\n      for (const filename of goldenFiles) {\n        const filePath = join(fixturesDir, filename);\n        const content = readFileSync(filePath, 'utf8');\n\n        expect(content).toBeDefined();\n        expect(content.length).toBeGreaterThan(0);\n\n        // Validate that files can be parsed\n        if (filename.endsWith('.json')) {\n          expect(() => JSON.parse(content)).not.toThrow();\n        } else if (filename.endsWith('.csv')) {\n          expect(content).toContain(',');\n        } else if (filename.endsWith('.ndjson')) {\n          const lines = content.trim().split('\\n');\n          for (const line of lines) {\n            if (line.trim()) {\n              expect(() => JSON.parse(line)).not.toThrow();\n            }\n          }\n        }\n      }\n    });\n\n    it('should validate that golden files are consistent', async () => {\n      // Test that all golden files for the same data produce equivalent results\n      const simpleJson = readFileSync(join(fixturesDir, 'simple.json'), 'utf8');\n      const simpleCsv = readFileSync(join(fixturesDir, 'simple.csv'), 'utf8');\n      const simpleNdjson = readFileSync(join(fixturesDir, 'simple.ndjson'), 'utf8');\n\n      const jsonResult = await parseFrom(SimpleSchema, 'json', simpleJson);\n      const csvResult = await parseFrom(SimpleSchema, 'csv', simpleCsv);\n      const ndjsonResult = await parseFrom(SimpleSchema, 'ndjson', simpleNdjson);\n\n      expect(jsonResult).toEqual(csvResult);\n      expect(jsonResult).toEqual(ndjsonResult);\n      expect(csvResult).toEqual(ndjsonResult);\n    });\n  });\n\n  describe('Golden File Edge Cases', () => {\n    it('should handle golden files with special characters', async () => {\n      const specialData = {\n        name: 'JosÃ© \"The Great\" FranÃ§ois',\n        age: 30,\n        active: true,\n      };\n\n      const result = await formatTo(SimpleSchema, 'json', specialData, { deterministic: true });\n      const parsed = JSON.parse(result);\n\n      expect(parsed.name).toBe('JosÃ© \"The Great\" FranÃ§ois');\n    });\n\n    it('should handle golden files with unicode characters', async () => {\n      const unicodeData = {\n        name: 'ä¸­æ–‡æµ‹è¯• ðŸš€',\n        age: 30,\n        active: true,\n      };\n\n      const result = await formatTo(SimpleSchema, 'json', unicodeData, { deterministic: true });\n      const parsed = JSON.parse(result);\n\n      expect(parsed.name).toBe('ä¸­æ–‡æµ‹è¯• ðŸš€');\n    });\n\n    it('should handle golden files with empty arrays', async () => {\n      const emptyArrayData = {\n        id: 'test',\n        metadata: {\n          tags: [],\n          score: 0,\n        },\n        items: [],\n      };\n\n      const result = await formatTo(ComplexSchema, 'json', emptyArrayData, { deterministic: true });\n      const parsed = JSON.parse(result);\n\n      expect(parsed.metadata.tags).toEqual([]);\n      expect(parsed.items).toEqual([]);\n    });\n\n    it('should handle golden files with null values', async () => {\n      const nullData = {\n        name: 'Test',\n        age: 30,\n        active: true,\n      };\n\n      const result = await formatTo(SimpleSchema, 'json', nullData, { deterministic: true });\n      const parsed = JSON.parse(result);\n\n      expect(parsed.name).toBe('Test');\n      expect(parsed.age).toBe(30);\n      expect(parsed.active).toBe(true);\n    });\n  });\n});\n"
        }
    ]
}